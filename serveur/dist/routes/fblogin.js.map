{"version":3,"sources":["../../routes/fblogin.js"],"names":["axios","require","express","router","Router","querystring","SUCCESS_STATUS","REDIRECT_STATUS","NOT_FOUND_STATUS","appAccessToken","userAccessToken","userFbId","userFriendList","_sendResponse","status","message","res","send","_getUserAccessToken","str","requestToken","redirectURI","client_id","redirect_uri","client_secret","code","get","_getAppAccessToken","apiAppRequest","requestAPI","grant_type","_inspectUserToken","inspectTokenRequest","input_token","access_token","_getUserFriendList","userFriendListRequest","userID","req","next","console","log","facebookURI","parse","originalUrl","substring","indexOf","length","then","response","data","user_id","catch","error","module","exports"],"mappings":"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","file":"fblogin.js","sourcesContent":["const axios = require('axios');\r\nconst express = require('express');\r\nconst router = express.Router();\r\nconst querystring = require('querystring');\r\n\r\nconst SUCCESS_STATUS = 200;\r\nconst REDIRECT_STATUS = 304;\r\nconst NOT_FOUND_STATUS = 404;\r\n\r\nlet appAccessToken;\r\nlet userAccessToken;\r\nlet userFbId;\r\nlet userFriendList;\r\n\r\nconst _sendResponse = (status, message, res) => {\r\n    res.status(status);\r\n    res.send(message);\r\n};\r\n\r\nconst _getUserAccessToken = (str) => {\r\n    let requestToken = {\r\n        redirectURI: 'https://graph.facebook.com/v2.11/oauth/access_token?',\r\n        client_id: '137357800216709',\r\n        redirect_uri: 'http://localhost:3000/handleauth',\r\n        client_secret: '8120bf1c2ce2729a20d024a8c491c9b5',\r\n        code: str.code\r\n    };\r\n\r\n    return axios.get(requestToken.redirectURI + 'client_id=' + requestToken.client_id + '&redirect_uri=' + requestToken.redirect_uri\r\n        + '&client_secret=' + requestToken.client_secret + '&code=' + requestToken.code)\r\n};\r\n\r\nconst _getAppAccessToken = () => {\r\n\r\n    const apiAppRequest = {\r\n        requestAPI: 'https://graph.facebook.com/oauth/access_token?',\r\n        client_id: '137357800216709',\r\n        client_secret: '8120bf1c2ce2729a20d024a8c491c9b5',\r\n        grant_type: 'client_credentials'\r\n    };\r\n\r\n    return axios.get(apiAppRequest.requestAPI + 'client_id=' + apiAppRequest.client_id + '&client_secret='\r\n        + apiAppRequest.client_secret + '&grant_type=' + apiAppRequest.grant_type)\r\n};\r\n\r\nconst _inspectUserToken = () => {\r\n    let inspectTokenRequest = {\r\n        redirectURI: 'https://graph.facebook.com/debug_token?',\r\n        input_token: userAccessToken,\r\n        access_token: appAccessToken\r\n    };\r\n\r\n    return axios.get(inspectTokenRequest.redirectURI + 'input_token=' + inspectTokenRequest.input_token + '&access_token=' + inspectTokenRequest.access_token)\r\n};\r\n\r\nconst _getUserFriendList = () => {\r\n    let userFriendListRequest = {\r\n        redirectURI: 'https://graph.facebook.com/v2.11/',\r\n        userAccessToken: userAccessToken,\r\n        userID: userFbId\r\n    }\r\n\r\n    return axios.get(userFriendListRequest.redirectURI + userFriendListRequest.userID + '/friends?access_token=' + userFriendListRequest.userAccessToken)\r\n};\r\n\r\nrouter.get('/', function (req, res, next) {\r\n    console.log(\"GET /fblogin\");\r\n\r\n    let facebookURI = {\r\n        redirectURI: 'https://www.facebook.com/v2.11/dialog/oauth?',\r\n        client_id: '137357800216709',\r\n        redirect_uri: 'http://localhost:3000/handleauth'\r\n    };\r\n\r\n    _sendResponse(SUCCESS_STATUS, facebookURI, res)\r\n\r\n    console.log(\"end GET /fblogin\");\r\n});\r\n\r\nrouter.get('/handleauth', function (req, res, next) {\r\n    console.log(\"GET /fblogin/handleauth\");\r\n\r\n    let str = querystring.parse(req.originalUrl.substring(req.originalUrl.indexOf(\"?\") + 1, req.originalUrl.length));\r\n\r\n    console.log('STR VALUE :' + str.code);\r\n\r\n    _getUserAccessToken(str)\r\n        .then(response => {\r\n\r\n            userAccessToken = response.data.access_token;\r\n\r\n            _getAppAccessToken()\r\n                .then(response => {\r\n\r\n                    appAccessToken = response.data.access_token;\r\n\r\n                    _inspectUserToken()\r\n                        .then(response => {\r\n                            userFbId = response.data.data.user_id;\r\n\r\n                            _getUserFriendList()\r\n                                .then(response => {\r\n                                    userFriendList = response.data.data;\r\n\r\n                                    console.log(userFriendList);\r\n\r\n                                    //TODO: Send response to client\r\n                                    _sendResponse(SUCCESS_STATUS, userFriendList, res)\r\n                                })\r\n                                .catch(error => {\r\n                                    console.log(error)\r\n                                })\r\n                        })\r\n                        .catch(error => {\r\n                            console.log(error)\r\n                        });\r\n                })\r\n                .catch(error => {\r\n                    console.log(error)\r\n                });\r\n        })\r\n        .catch(error => {\r\n            console.log(error)\r\n        });\r\n\r\n    console.log(\"end GET /fblogin/handleauth\");\r\n});\r\n\r\nmodule.exports = router;"]}