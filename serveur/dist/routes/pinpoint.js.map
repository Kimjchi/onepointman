{"version":3,"sources":["../../routes/pinpoint.js"],"names":["express","require","router","Router","db","squelb","squel","useFlavour","sender","post","req","res","toCreate","iduser","body","idgroup","pinlg","pinlt","description","daterdv","dateexpiration","Date","setDate","getDate","query","insert","into","set","parseInt","toLocaleDateString","toLocaleTimeString","returning","toString","one","then","row","response","idpinpoint","sendResponse","SUCCESS_STATUS","catch","console","log","e","BAD_REQUEST","status","message","delete","toDelete","from","where","module","exports"],"mappings":"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","file":"pinpoint.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst db = require('../connection');\r\nconst squelb = require('squel');\r\nconst squel = squelb.useFlavour('postgres');\r\n\r\nconst sender = require('../sender');\r\n\r\nrouter.post('/createpinpoint/', function (req, res) {\r\n\r\n    let toCreate = {\r\n        iduser: req.body.iduser,\r\n        idgroup: req.body.idgroup,\r\n        pinlg: req.body.pinlg,\r\n        pinlt: req.body.pinlt,\r\n        description: req.body.description,\r\n        daterdv: req.body.daterdv,\r\n    };\r\n\r\n    let dateexpiration = new Date(toCreate.daterdv);\r\n    dateexpiration.setDate(dateexpiration.getDate() + 1);\r\n\r\n    let query = squel.insert()\r\n        .into('public.\"PINPOINT\"')\r\n        .set('idcreator', parseInt(toCreate.iduser, 10))\r\n        .set('idgroup', parseInt(toCreate.idgroup, 10))\r\n        .set('pinlt', parseInt(toCreate.pinlt, 10))\r\n        .set('pinlg', parseInt(toCreate.pinlg, 10))\r\n        .set('description', toCreate.description)\r\n        .set('daterdv', toCreate.daterdv)\r\n        .set('dateexp', dateexpiration.toLocaleDateString() + ' ' + dateexpiration.toLocaleTimeString())\r\n        .returning('idpinpoint')\r\n        .toString();\r\n\r\n    db.one(query)\r\n        .then((row) => {\r\n            let response = {\r\n                idpinpoint: row.idpinpoint\r\n            };\r\n            sender.sendResponse(sender.SUCCESS_STATUS, response, res)\r\n        })\r\n        .catch(e => {\r\n            console.log(e);\r\n            sender.sendResponse(sender.BAD_REQUEST, {status: 'fail', message: 'Error while creating pinpoint'}, res);\r\n        })\r\n});\r\n\r\nrouter.delete('/deletepinpoint/', function (req, res) {\r\n\r\n    let toDelete = {\r\n        iduser: req.body.iduser,\r\n        idgroup: req.body.idgroup,\r\n        idpinpoint: req.body.idpinpoint,\r\n    };\r\n\r\n    let query = squel.delete()\r\n        .from('public.\"PINPOINT\"')\r\n        .where('idcreator = ?', toDelete.iduser)\r\n        .where('idgroup = ?', toDelete.idgroup)\r\n        .where('idpinpoint = ?', toDelete.idpinpoint)\r\n        .toString();\r\n\r\n    db.query(query)\r\n        .then(() => {\r\n            sender.sendResponse(sender.SUCCESS_STATUS, {status: 'success', message: 'Pinpoint deleted'}, res)\r\n        })\r\n        .catch(e => {\r\n            console.log(e);\r\n            sender.sendResponse(sender.BAD_REQUEST, {status: 'fail', message: 'Error while deleting pinpoint'}, res);\r\n        })\r\n\r\n});\r\n\r\nmodule.exports = router;\r\n"]}